**事件循环**

所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。

主线程之外，还存在一个”任务队列”（task queue）。只要异步任务有了运行结果，就在”任务队列”之中放置一个事件。

一旦”执行栈”中的所有同步任务执行完毕，系统就会读取”任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。

主线程不断重复上面的第三步。

主线程从”任务队列”中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。只要主线程空了，就会去读取”任务队列”，这就是JavaScript的运行机制。这个过程会循环反复。

Js的代码执行是基于一种事件循环的机制，之所以称为事件循环

**概念**

**同步任务：**在主线程排队执行的任务，只有执行完前一个任务，才能执行后一个任务

**异步任务：**不进入主线程，而进入任务队列（task queue）的任务，只有任务队列通知主线程，某个任务可以执行了，该任务才会进入主线程执行

**任务队列：**

任务队列是一个先进先出的数据结构，排在前面的事件优先被主线程读取。

当执行某个函数，只要指定过回调函数，这些事件发生时就会进入任务队列中，等待主线程读取，遵循先进先出原则，

**执行栈：**

执行任务队列中的某个任务，这个被执行的任务就称为执行栈。

**异步执行机制：**

- 所有同步任务都在主线程上执行，形成一个执行栈
- 主线程外，还存在一个“任务队列（task queue）”只要异步任务有了运行结果，就在“任务队列”之中放置一个事件。
- 一旦“执行栈”中的所有同步任务执行完毕系统就会读取“任务队列”，找到对应的异步任务，进入执行栈，开始执行。



**宏任务与微任务**

JS 的任务可以分为宏任务（Macrotask）和微任务 （Microtask）。

一般的Js代码 script（主线程的整体代码），鼠标事件，键盘事件，Ajax请求，setTimeout定时器setlmmediate  等都属于**宏任务**。

 process.nextTick,  promise.then()等属于**微任务** 

**事件循环：**

主线程从任务队列中读取事件，这个过程是循环不断地，所以整个的这种运行机制又称之为Event  Loop（事件循环）

- 执行最先进入队列的宏任务（通常是script整体代码）
- 检查是否存在微任务，如果有就执行，直至清空微任务队列，
- 执行下一个宏任务，执行完了后执行微任务